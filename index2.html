<!DOCTYPE html>
<html>

<head>

    <h1>Family Tree</h1>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <!-- <script> margin = ({ top: 10, right: 120, bottom: 10, left: 40 })</script> -->
    <style>
        .image {
            fill: black;
            stroke: silver;
            background-size: contain;
        }

        .cover {
            background-size: =cover
        }


        path {
            fill: none;
            stroke: silver;
            stroke-width: 3px;
        }

        text {

            text-anchor: middle;
            color: rgb(255, 255, 255);
        }

        .bigger {
            font-size: 20px;
        }

        .hide {
            visibility: hidden;
        }
    </style>
</head>

<body>
    <script>
        /* PSEUDOCODE
        
        Create framework boundaries (i.e. svg and tree boundaries like canvas and painting)
        Load data
        Create text
        Create boxes
        Create paths
        
        */
        var img_height = 100;
        var img_width = 200;
        // image.style.height = img_height + "px";
        // image.style.width = img_width + "px";

        // creates a frame 600x600 px to work in, all elements shifted ↓ & → 50 px
        var svg = d3.select("body").append("svg")
            .attr("width", 2000).attr("height", 2000)
            .append("g").attr("transform", "translate(50,50)");//can comment out ot show signif

        // self-explanatory
        var familytree_Steve = [
            {
                "name": "Steve", "parent": "", "spouse": "Shirley", "Generation": 1, "img": "data/Grandpa.jpg", "spouse_img": "data/Grandma.jpg"
            },
            { "name": "Alex", "parent": "Steve", "spouse": "Alexis", "Generation": 2, "img": "data/Grandpa.jpg", "spouse_img": "data/Grandma.jpg" },
            { "name": "Jocelyn", "parent": "Steve", "spouse": "Johnny", "Generation": 3, "img": "data/Grandma.jpg", "spouse_img": "data/Grandpa.jpg" },
            //{ "name": "Johnny", "parent": "", "spouse": "Jocelyn", "Generation": 2 },
            //{ "name": "Johnny", "parent": "", "spouse": "Jocelyn", "Generation": 2 },
            //{ "name": "Alexis", "parent": "Alexandra", "spouse": "Alex", "Generation": 2 },
            //{ "name": "Shirley", "parent": "", "spouse": "Steve", "Generation": 1 },
            { "name": "Ingrid", "parent": "Alex", "Generation": 3, "img": "data/Grandma.jpg", },
            { "name": "Sasha", "parent": "Alex", "Generation": 3, "img": "data/Grandpa.jpg", },
            { "name": "Suzie Q", "parent": "Jocelyn", "Generation": 3, "img": "data/Grandma.jpg", }
        ];

        // Molds the data,
        var dataStructure = d3.stratify()
            .id(function (d) { return d.name; }) //the name in "d.name" needs to match data
            .parentId(function (d) { return d.parent; })(familytree_Steve);
        // const tree_x = (2 ^ (information.descendants().height + 1))*50
        console.log(dataStructure);
        const tree_y = 100 * (dataStructure.height + 1);
        const tree_x = (2 ** (dataStructure.height + 1)) * 150;// variablize 150 to change based on number of ppl in tree so everyone is spaced out properly
        console.log("tree_y: " + tree_y);
        console.log("tree_x: " + tree_x);

        var treeStructure = d3.tree().size([tree_x, tree_y]);

        var information = treeStructure(dataStructure); //??? doesn't seem necessary according to prints of descendants and links
        // But if we dont use it, the code doent work
        // console.log(treeStructure)
        console.log(information.descendants());
        console.log(information.links());
        // looking at log info:
        // height: how many layers of descedants r directly below this node
        // depth: how many above, opposite to height









        // Path drawing stuff??? why 20 -> variablize later with once we decide dimensions of buttons
        var connections = svg.append("g").selectAll("path")
            .data(information.links());
        connections.enter().append("path")
            .attr("d", function (d) {
                // start pt, control pt, 2nd control pt, end pt for curved path
                return "M" + (d.source.x + img_height) + "," + (d.source.y) +
                    " v  " + img_height +
                    "H" + (d.target.x - (img_height / 2)) +
                    " V" + d.target.y;

                //"C" + d.source.x
                //     + "," + (d.source.y + d.target.y) / 2 + " "
                //     + d.target.x + "," + (d.source.y + d.target.y) / 2 + " "
                //     + d.target.x + "," + d.target.y;
            });

        var spouseConnections = svg.append("g").selectAll("path")
            .data(information.links());
        connections.enter().append("path")
            .attr("d", function (d) {
                return "M" + (d.source.x) + ',' + (d.source.y) +
                    "v 0" +
                    "h " + img_height * 2;

            })



        // Creates the boxes to represent nodes

        var rectangles = svg.append("g").selectAll("image")
            .data(information.descendants());
        rectangles.enter().append("image")
            .attr("x", function (d) { return d.x - ((img_width + img_height) / 2); }) //how not hardcode 40 and 20? make variables gloablly in non-script tags?
            .attr("y", function (d) { return d.y - (img_height / 2); })
            .attr('height', img_height).attr('width', img_width)
            .attr('class', 'image')
            // .attr("width", function (d) { return img_height; })
            // .attr("height", function (d) { return img_width; })
            .attr("href", function (d) {
                var out = d.data.img;
                return out;
            })

        // .on("mousedown", function (d) {
        // d3.select("#details")
        //     .style("visibility", "visible")
        //     .html(function () {
        //         if (d.data.spouse != undefined)
        //             return "Spouse: " + d.data.spouse;
        //         else
        //             return "No Spouse";
        //     });
        // })
        // .on("mouseup", function () {
        //     d3.select("#details").style("visibility","hidden");
        // });;

        var spouseRectangles = svg.append("g").selectAll("image")
            .data(information.descendants());
        spouseRectangles.enter().append("image")
            .attr("x", function (d) { return d.x + ((img_width + img_height) / 2); })
            .attr("y", function (d) { return d.y - (img_height / 2); })
            .attr('height', img_height).attr('width', img_width)
            .attr("href", function (d) {
                var out = d.data.spouse_img;
                return out;
            })
            .classed("hide", function (d) { // prevents spouse rect from appearing for ppl w/out spouses
                if (d.data.spouse == undefined)
                    return true;
                else
                    return false;
            });

        // var pictures = svg.append("g").selectAll("img")
        //     .data(information.descendants());
        // pictures.enter().append("img")
        //     .img(function (d) { return d.data.img; });

        var names = svg.append("g").selectAll("text")
            .data(information.descendants());
        names.enter().append("text")
            .text(function (d) { return d.data.name; })
            .attr("x", function (d) { return d.x - (img_height / 2); })
            .attr("y", function (d) { return d.y; })
        // .classed("bigger", true);

        var spouseNames = svg.append("g").selectAll("text")
            .data(information.descendants());
        spouseNames.enter().append("text")
            .text(function (d) { return d.data.spouse; })
            .attr("x", function (d) { return d.x + (img_width + (img_height / 2)); })
            .attr("y", function (d) { return d.y; })
            .classed("bigger", true);
    </script>
</body>

</html>